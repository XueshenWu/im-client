{
  "openapi": "3.0.0",
  "info": {
    "title": "Image Management API",
    "version": "1.0.0",
    "description": "API for managing images with EXIF data, thumbnails, and synchronization",
    "contact": {
      "name": "API Support"
    }
  },
  "servers": [
    {
      "url": "",
      "description": "API server"
    }
  ],
  "tags": [
    {
      "name": "Images",
      "description": "Image management endpoints"
    },
    {
      "name": "Sync",
      "description": "Synchronization endpoints"
    },
    {
      "name": "Health",
      "description": "Health check endpoints"
    }
  ],
  "components": {
    "schemas": {
      "Image": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "example": 1
          },
          "uuid": {
            "type": "string",
            "format": "uuid"
          },
          "filename": {
            "type": "string",
            "example": "photo.jpg"
          },
          "originalName": {
            "type": "string",
            "example": "vacation-photo.jpg"
          },
          "filePath": {
            "type": "string",
            "example": "/storage/images/photo.jpg"
          },
          "thumbnailPath": {
            "type": "string",
            "example": "/storage/thumbnails/photo.jpg"
          },
          "fileSize": {
            "type": "integer",
            "example": 2048000
          },
          "format": {
            "type": "string",
            "enum": [
              "jpg",
              "jpeg",
              "png",
              "tif",
              "tiff"
            ]
          },
          "width": {
            "type": "integer",
            "example": 1920
          },
          "height": {
            "type": "integer",
            "example": 1080
          },
          "hash": {
            "type": "string",
            "example": "abc123def456..."
          },
          "mimeType": {
            "type": "string",
            "example": "image/jpeg"
          },
          "isCorrupted": {
            "type": "boolean",
            "default": false
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          },
          "deletedAt": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          }
        }
      },
      "ImageWithExif": {
        "allOf": [
          {
            "$ref": "#/components/schemas/Image"
          },
          {
            "type": "object",
            "properties": {
              "exifData": {
                "$ref": "#/components/schemas/ExifData"
              }
            }
          }
        ]
      },
      "ExifData": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "imageId": {
            "type": "integer"
          },
          "cameraMake": {
            "type": "string",
            "example": "Canon"
          },
          "cameraModel": {
            "type": "string",
            "example": "EOS 5D Mark IV"
          },
          "lensModel": {
            "type": "string",
            "example": "EF 24-70mm f/2.8L II USM"
          },
          "iso": {
            "type": "integer",
            "example": 400
          },
          "shutterSpeed": {
            "type": "string",
            "example": "1/250"
          },
          "aperture": {
            "type": "string",
            "example": "f/5.6"
          },
          "focalLength": {
            "type": "string",
            "example": "70mm"
          },
          "dateTaken": {
            "type": "string",
            "format": "date-time"
          },
          "gpsLatitude": {
            "type": "number",
            "format": "double"
          },
          "gpsLongitude": {
            "type": "number",
            "format": "double"
          },
          "gpsAltitude": {
            "type": "number",
            "format": "double"
          },
          "orientation": {
            "type": "integer"
          },
          "metadata": {
            "type": "object"
          }
        }
      },
      "ImageStats": {
        "type": "object",
        "properties": {
          "totalCount": {
            "type": "integer",
            "example": 100
          },
          "totalSize": {
            "type": "integer",
            "example": 52428800
          },
          "corruptedCount": {
            "type": "integer",
            "example": 2
          },
          "jpgCount": {
            "type": "integer",
            "example": 50
          },
          "pngCount": {
            "type": "integer",
            "example": 30
          },
          "tifCount": {
            "type": "integer",
            "example": 20
          }
        }
      },
      "OperationStats": {
        "type": "object",
        "properties": {
          "requested": {
            "type": "integer",
            "description": "Number of items requested",
            "example": 10
          },
          "successful": {
            "type": "integer",
            "description": "Number of successful operations",
            "example": 9
          },
          "failed": {
            "type": "integer",
            "description": "Number of failed operations",
            "example": 1
          }
        }
      },
      "OperationError": {
        "type": "object",
        "properties": {
          "uuid": {
            "type": "string",
            "format": "uuid"
          },
          "error": {
            "type": "string",
            "example": "Image not found"
          }
        }
      },
      "UploadUrls": {
        "type": "object",
        "properties": {
          "imageUrl": {
            "type": "string",
            "format": "uri",
            "example": "https://storage.example.com/..."
          },
          "thumbnailUrl": {
            "type": "string",
            "format": "uri",
            "example": "https://storage.example.com/..."
          },
          "expiresIn": {
            "type": "integer",
            "description": "URL expiry time in seconds",
            "example": 900
          }
        }
      },
      "ReplaceResult": {
        "type": "object",
        "properties": {
          "image": {
            "$ref": "#/components/schemas/Image"
          },
          "uploadUrls": {
            "$ref": "#/components/schemas/UploadUrls"
          }
        }
      },
      "DownloadInfo": {
        "type": "object",
        "properties": {
          "uuid": {
            "type": "string",
            "format": "uuid"
          },
          "filename": {
            "type": "string",
            "example": "photo.jpg"
          },
          "downloadUrl": {
            "type": "string",
            "format": "uri",
            "example": "https://storage.example.com/..."
          },
          "expiresIn": {
            "type": "integer",
            "description": "URL expiry time in seconds",
            "example": 3600
          },
          "metadata": {
            "type": "object",
            "properties": {
              "id": {
                "type": "integer"
              },
              "format": {
                "type": "string"
              },
              "fileSize": {
                "type": "integer"
              },
              "width": {
                "type": "integer"
              },
              "height": {
                "type": "integer"
              },
              "hash": {
                "type": "string"
              },
              "mimeType": {
                "type": "string"
              },
              "isCorrupted": {
                "type": "boolean"
              },
              "createdAt": {
                "type": "string",
                "format": "date-time"
              },
              "updatedAt": {
                "type": "string",
                "format": "date-time"
              }
            }
          },
          "exifData": {
            "nullable": true,
            "oneOf": [
              {
                "$ref": "#/components/schemas/ExifData"
              },
              {
                "type": "null"
              }
            ]
          }
        }
      },
      "HealthStatus": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "ok",
              "degraded"
            ],
            "example": "ok"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          },
          "services": {
            "type": "object",
            "properties": {
              "postgresql": {
                "$ref": "#/components/schemas/ServiceHealth"
              },
              "redis": {
                "$ref": "#/components/schemas/ServiceHealth"
              },
              "minio": {
                "$ref": "#/components/schemas/ServiceHealth"
              }
            }
          }
        }
      },
      "ServiceHealth": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "connected",
              "disconnected",
              "unknown"
            ],
            "example": "connected"
          },
          "responseTime": {
            "type": "number",
            "description": "Response time in milliseconds",
            "example": 5
          },
          "error": {
            "type": "string",
            "description": "Error message if disconnected"
          }
        }
      },
      "Error": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "example": "Error message"
          },
          "message": {
            "type": "string",
            "example": "Detailed error description"
          },
          "statusCode": {
            "type": "integer",
            "example": 400
          }
        }
      }
    }
  },
  "paths": {
    "/api/health": {
      "get": {
        "summary": "Health check endpoint",
        "tags": [
          "Health"
        ],
        "responses": {
          "200": {
            "description": "All services are healthy",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "ok"
                    },
                    "timestamp": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "services": {
                      "type": "object",
                      "properties": {
                        "postgresql": {
                          "type": "object",
                          "properties": {
                            "status": {
                              "type": "string",
                              "example": "connected"
                            },
                            "responseTime": {
                              "type": "number",
                              "description": "Response time in milliseconds"
                            }
                          }
                        },
                        "redis": {
                          "type": "object",
                          "properties": {
                            "status": {
                              "type": "string",
                              "example": "connected"
                            },
                            "responseTime": {
                              "type": "number",
                              "description": "Response time in milliseconds"
                            }
                          }
                        },
                        "minio": {
                          "type": "object",
                          "properties": {
                            "status": {
                              "type": "string",
                              "example": "connected"
                            },
                            "responseTime": {
                              "type": "number",
                              "description": "Response time in milliseconds"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "503": {
            "description": "One or more services are unhealthy"
          }
        }
      }
    },
    "/api/images": {
      "get": {
        "summary": "Get all images",
        "tags": [
          "Images"
        ],
        "parameters": [
          {
            "in": "query",
            "name": "withExif",
            "schema": {
              "type": "boolean"
            },
            "description": "Include EXIF data"
          }
        ],
        "responses": {
          "200": {
            "description": "List of images",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "count": {
                      "type": "integer"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Image"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/images/paginated": {
      "get": {
        "summary": "Get paginated images with cursor-based pagination (infinite scroll)",
        "tags": [
          "Images"
        ],
        "parameters": [
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 20
            },
            "description": "Number of items per page (max 100)"
          },
          {
            "in": "query",
            "name": "cursor",
            "schema": {
              "type": "string"
            },
            "description": "Cursor for pagination (base64 encoded ID from previous response)"
          },
          {
            "in": "query",
            "name": "collectionId",
            "schema": {
              "type": "integer"
            },
            "description": "Filter images by collection ID"
          },
          {
            "in": "query",
            "name": "withExif",
            "schema": {
              "type": "boolean"
            },
            "description": "Include EXIF data"
          },
          {
            "in": "query",
            "name": "sortBy",
            "schema": {
              "type": "string",
              "enum": [
                "name",
                "size",
                "type",
                "updatedAt"
              ]
            },
            "description": "Field to sort by (name=originalName, size=fileSize, type=format, updatedAt=updatedAt)"
          },
          {
            "in": "query",
            "name": "sortOrder",
            "schema": {
              "type": "string",
              "enum": [
                "asc",
                "desc"
              ],
              "default": "desc"
            },
            "description": "Sort order (ascending or descending)"
          }
        ],
        "responses": {
          "200": {
            "description": "Paginated list of images",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "count": {
                      "type": "integer"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Image"
                      }
                    },
                    "pagination": {
                      "type": "object",
                      "properties": {
                        "nextCursor": {
                          "type": "string",
                          "nullable": true,
                          "description": "Cursor for next page (null if no more data)"
                        },
                        "hasMore": {
                          "type": "boolean",
                          "description": "Whether there are more items to load"
                        },
                        "limit": {
                          "type": "integer",
                          "description": "Items per page"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid parameters"
          }
        }
      }
    },
    "/api/images/page": {
      "get": {
        "summary": "Get paginated images with page-based pagination (traditional pagination)",
        "tags": [
          "Images"
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "default": 1
            },
            "description": "Page number (starts from 1)"
          },
          {
            "in": "query",
            "name": "pageSize",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 20
            },
            "description": "Number of items per page (max 100)"
          },
          {
            "in": "query",
            "name": "collectionId",
            "schema": {
              "type": "integer"
            },
            "description": "Filter images by collection ID"
          },
          {
            "in": "query",
            "name": "withExif",
            "schema": {
              "type": "boolean"
            },
            "description": "Include EXIF data"
          },
          {
            "in": "query",
            "name": "sortBy",
            "schema": {
              "type": "string",
              "enum": [
                "name",
                "size",
                "type",
                "updatedAt"
              ]
            },
            "description": "Field to sort by (name=originalName, size=fileSize, type=format, updatedAt=updatedAt)"
          },
          {
            "in": "query",
            "name": "sortOrder",
            "schema": {
              "type": "string",
              "enum": [
                "asc",
                "desc"
              ],
              "default": "desc"
            },
            "description": "Sort order (ascending or descending)"
          }
        ],
        "responses": {
          "200": {
            "description": "Paginated list of images",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "count": {
                      "type": "integer",
                      "description": "Number of items in current page"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Image"
                      }
                    },
                    "pagination": {
                      "type": "object",
                      "properties": {
                        "page": {
                          "type": "integer",
                          "description": "Current page number"
                        },
                        "pageSize": {
                          "type": "integer",
                          "description": "Items per page"
                        },
                        "totalItems": {
                          "type": "integer",
                          "description": "Total number of items"
                        },
                        "totalPages": {
                          "type": "integer",
                          "description": "Total number of pages"
                        },
                        "hasNext": {
                          "type": "boolean",
                          "description": "Whether there is a next page"
                        },
                        "hasPrev": {
                          "type": "boolean",
                          "description": "Whether there is a previous page"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid parameters"
          }
        }
      }
    },
    "/api/images/metadata": {
      "get": {
        "summary": "Get minimal metadata for all images (for efficient sync state comparison)",
        "tags": [
          "Images"
        ],
        "parameters": [
          {
            "in": "query",
            "name": "since",
            "schema": {
              "type": "integer"
            },
            "description": "Only return metadata for images modified since this sync sequence"
          }
        ],
        "responses": {
          "200": {
            "description": "List of image metadata",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "count": {
                      "type": "integer"
                    },
                    "currentSequence": {
                      "type": "integer"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "uuid": {
                            "type": "string"
                          },
                          "hash": {
                            "type": "string"
                          },
                          "updatedAt": {
                            "type": "string"
                          },
                          "fileSize": {
                            "type": "integer"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/images/stats": {
      "get": {
        "summary": "Get image statistics",
        "tags": [
          "Images"
        ],
        "responses": {
          "200": {
            "description": "Image statistics",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/ImageStats"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/images/file/uuid/{uuid}": {
      "get": {
        "summary": "Get image file by UUID with optional metadata",
        "tags": [
          "Images"
        ],
        "parameters": [
          {
            "in": "path",
            "name": "uuid",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Image UUID"
          },
          {
            "in": "query",
            "name": "info",
            "schema": {
              "type": "boolean"
            },
            "description": "Include image metadata in response headers (X-Image-*)"
          }
        ],
        "responses": {
          "200": {
            "description": "Image file",
            "headers": {
              "X-Image-Id": {
                "schema": {
                  "type": "integer"
                },
                "description": "Image ID (when info=true)"
              },
              "X-Image-UUID": {
                "schema": {
                  "type": "string"
                },
                "description": "Image UUID (when info=true)"
              },
              "X-Image-Filename": {
                "schema": {
                  "type": "string"
                },
                "description": "Image filename (when info=true)"
              },
              "X-Image-Format": {
                "schema": {
                  "type": "string"
                },
                "description": "Image format (when info=true)"
              },
              "X-Image-File-Size": {
                "schema": {
                  "type": "integer"
                },
                "description": "File size in bytes (when info=true)"
              },
              "X-Image-Width": {
                "schema": {
                  "type": "integer"
                },
                "description": "Image width (when info=true)"
              },
              "X-Image-Height": {
                "schema": {
                  "type": "integer"
                },
                "description": "Image height (when info=true)"
              },
              "X-Image-Hash": {
                "schema": {
                  "type": "string"
                },
                "description": "SHA-256 hash (when info=true)"
              },
              "X-Image-Created-At": {
                "schema": {
                  "type": "string"
                },
                "description": "Creation timestamp (when info=true)"
              },
              "X-Image-Updated-At": {
                "schema": {
                  "type": "string"
                },
                "description": "Update timestamp (when info=true)"
              }
            },
            "content": {
              "image/*": {
                "schema": {
                  "type": "string",
                  "format": "binary"
                }
              }
            }
          },
          "404": {
            "description": "Image not found"
          }
        }
      }
    },
    "/api/images/uuid/{uuid}": {
      "get": {
        "summary": "Get image by UUID",
        "tags": [
          "Images"
        ],
        "parameters": [
          {
            "in": "path",
            "name": "uuid",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "Image UUID"
          }
        ],
        "responses": {
          "200": {
            "description": "Image details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Image"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Image not found"
          }
        }
      }
    },
    "/api/images/replace": {
      "patch": {
        "summary": "Replace images (single or batch) - Update metadata and get presigned URLs",
        "tags": [
          "Images"
        ],
        "description": "Unified endpoint for replacing images. If array length is 1, treats as single operation. If > 1, creates batch operation log.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "replacements"
                ],
                "properties": {
                  "replacements": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": [
                        "uuid",
                        "filename",
                        "format",
                        "mimeType"
                      ],
                      "properties": {
                        "uuid": {
                          "type": "string",
                          "format": "uuid",
                          "description": "Image UUID"
                        },
                        "filename": {
                          "type": "string",
                          "description": "New filename"
                        },
                        "format": {
                          "type": "string",
                          "description": "File format (jpg, png, etc.)"
                        },
                        "mimeType": {
                          "type": "string",
                          "description": "MIME type (image/jpeg, image/png, etc.)"
                        },
                        "width": {
                          "type": "integer",
                          "description": "Image width"
                        },
                        "height": {
                          "type": "integer",
                          "description": "Image height"
                        },
                        "fileSize": {
                          "type": "integer",
                          "description": "File size in bytes"
                        },
                        "hash": {
                          "type": "string",
                          "description": "SHA-256 hash"
                        },
                        "exifData": {
                          "type": "object",
                          "description": "Optional EXIF data to update"
                        }
                      }
                    },
                    "description": "Array of image replacements. Length 1 = single op, > 1 = batch op",
                    "example": [
                      {
                        "uuid": "867130af-dbc1-40cd-99f2-fb75baf9b8e1",
                        "filename": "new-image.jpg",
                        "format": "jpg",
                        "mimeType": "image/jpeg",
                        "width": 1920,
                        "height": 1080,
                        "fileSize": 524288,
                        "hash": "abc123...",
                        "exifData": {
                          "latitude": 37.7749,
                          "longitude": -122.4194
                        }
                      }
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Images replaced successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "replaced": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "image": {
                                "$ref": "#/components/schemas/Image"
                              },
                              "uploadUrls": {
                                "type": "object",
                                "properties": {
                                  "imageUrl": {
                                    "type": "string"
                                  },
                                  "thumbnailUrl": {
                                    "type": "string"
                                  },
                                  "expiresIn": {
                                    "type": "integer"
                                  }
                                }
                              }
                            }
                          }
                        },
                        "stats": {
                          "type": "object",
                          "properties": {
                            "requested": {
                              "type": "integer"
                            },
                            "successful": {
                              "type": "integer"
                            },
                            "failed": {
                              "type": "integer"
                            }
                          }
                        },
                        "errors": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "uuid": {
                                "type": "string"
                              },
                              "error": {
                                "type": "string"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request body"
          }
        }
      }
    },
    "/api/images/update/exif": {
      "patch": {
        "summary": "Update EXIF data (single or batch) - Unified endpoint",
        "tags": [
          "Images"
        ],
        "description": "Unified endpoint for updating EXIF data. If array length is 1, treats as single operation. If > 1, creates batch operation log.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "updates"
                ],
                "properties": {
                  "updates": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": [
                        "uuid",
                        "exifData"
                      ],
                      "properties": {
                        "uuid": {
                          "type": "string",
                          "format": "uuid",
                          "description": "Image UUID"
                        },
                        "exifData": {
                          "type": "object",
                          "description": "EXIF data to update",
                          "properties": {
                            "latitude": {
                              "type": "number"
                            },
                            "longitude": {
                              "type": "number"
                            },
                            "altitude": {
                              "type": "number"
                            },
                            "cameraMake": {
                              "type": "string"
                            },
                            "cameraModel": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    },
                    "description": "Array of EXIF updates. Length 1 = single op, > 1 = batch op",
                    "example": [
                      {
                        "uuid": "867130af-dbc1-40cd-99f2-fb75baf9b8e1",
                        "exifData": {
                          "latitude": 37.7749,
                          "longitude": -122.4194,
                          "cameraMake": "Canon"
                        }
                      },
                      {
                        "uuid": "f47ac10b-58cc-4372-a567-0e02b2c3d479",
                        "exifData": {
                          "latitude": 40.7128,
                          "longitude": -74.006
                        }
                      }
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "EXIF data updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "updated": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/Image"
                          }
                        },
                        "stats": {
                          "type": "object",
                          "properties": {
                            "requested": {
                              "type": "integer"
                            },
                            "successful": {
                              "type": "integer"
                            },
                            "failed": {
                              "type": "integer"
                            }
                          }
                        },
                        "errors": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "uuid": {
                                "type": "string"
                              },
                              "error": {
                                "type": "string"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request body"
          }
        }
      }
    },
    "/api/images/delete": {
      "delete": {
        "summary": "Delete images (single or batch) - Unified endpoint",
        "tags": [
          "Images"
        ],
        "description": "Unified endpoint for deleting images. If array length is 1, treats as single operation. If > 1, creates batch operation log.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "uuids"
                ],
                "properties": {
                  "uuids": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "description": "Array of image UUIDs to soft delete. Length 1 = single op, > 1 = batch op",
                    "example": [
                      "867130af-dbc1-40cd-99f2-fb75baf9b8e1",
                      "f47ac10b-58cc-4372-a567-0e02b2c3d479"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Images soft deleted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "deleted": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/Image"
                          }
                        },
                        "stats": {
                          "type": "object",
                          "properties": {
                            "requested": {
                              "type": "integer",
                              "description": "Number of UUIDs requested"
                            },
                            "successful": {
                              "type": "integer",
                              "description": "Number of images successfully deleted"
                            },
                            "failed": {
                              "type": "integer",
                              "description": "Number of images that failed to delete"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request body"
          }
        }
      }
    },
    "/api/images/batch/get/uuids": {
      "post": {
        "summary": "Get multiple images by UUIDs",
        "tags": [
          "Images"
        ],
        "parameters": [
          {
            "in": "query",
            "name": "withExif",
            "schema": {
              "type": "boolean"
            },
            "description": "Include EXIF data"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "uuids"
                ],
                "properties": {
                  "uuids": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "description": "Array of image UUIDs to retrieve",
                    "example": [
                      "867130af-dbc1-40cd-99f2-fb75baf9b8e1",
                      "f47ac10b-58cc-4372-a567-0e02b2c3d479"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Images retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "count": {
                      "type": "integer",
                      "description": "Number of images found"
                    },
                    "requested": {
                      "type": "integer",
                      "description": "Number of UUIDs requested"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Image"
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request body"
          }
        }
      }
    },
    "/api/images/dev/purge": {
      "delete": {
        "summary": "Purge all data (files + database + Redis) - DEV ONLY",
        "tags": [
          "Development"
        ],
        "description": "WARNING - Deletes ALL images, thumbnails, chunks, database records, and Redis sessions. Only available in development mode.",
        "responses": {
          "200": {
            "description": "Data purged successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "summary": {
                          "type": "object",
                          "properties": {
                            "deletedFiles": {
                              "type": "integer"
                            },
                            "deletedThumbnails": {
                              "type": "integer"
                            },
                            "deletedChunkDirectories": {
                              "type": "integer"
                            },
                            "deletedDatabaseRecords": {
                              "type": "integer"
                            },
                            "deletedRedisSessions": {
                              "type": "integer"
                            }
                          }
                        },
                        "errors": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "Forbidden in production mode"
          }
        }
      }
    },
    "/api/images/requestDownloadUrls": {
      "post": {
        "summary": "Request download URLs with metadata and EXIF data",
        "tags": [
          "Images"
        ],
        "description": "Get presigned download URLs along with image metadata and EXIF data for multiple images",
        "parameters": [
          {
            "in": "query",
            "name": "expiry",
            "schema": {
              "type": "integer",
              "default": 3600
            },
            "description": "URL expiry time in seconds (default 1 hour)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "uuids"
                ],
                "properties": {
                  "uuids": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "description": "Array of image UUIDs to get download URLs for",
                    "example": [
                      "867130af-dbc1-40cd-99f2-fb75baf9b8e1",
                      "f47ac10b-58cc-4372-a567-0e02b2c3d479"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Download URLs generated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "count": {
                      "type": "integer",
                      "description": "Number of successful downloads"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "downloads": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "uuid": {
                                "type": "string",
                                "format": "uuid"
                              },
                              "filename": {
                                "type": "string"
                              },
                              "downloadUrl": {
                                "type": "string",
                                "description": "Presigned download URL"
                              },
                              "expiresIn": {
                                "type": "integer",
                                "description": "URL expiry time in seconds"
                              },
                              "metadata": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "integer"
                                  },
                                  "format": {
                                    "type": "string"
                                  },
                                  "fileSize": {
                                    "type": "integer"
                                  },
                                  "width": {
                                    "type": "integer"
                                  },
                                  "height": {
                                    "type": "integer"
                                  },
                                  "hash": {
                                    "type": "string"
                                  },
                                  "mimeType": {
                                    "type": "string"
                                  },
                                  "isCorrupted": {
                                    "type": "boolean"
                                  },
                                  "createdAt": {
                                    "type": "string"
                                  },
                                  "updatedAt": {
                                    "type": "string"
                                  }
                                }
                              },
                              "exifData": {
                                "type": "object",
                                "nullable": true,
                                "description": "EXIF data if available"
                              }
                            }
                          }
                        },
                        "stats": {
                          "type": "object",
                          "properties": {
                            "requested": {
                              "type": "integer"
                            },
                            "successful": {
                              "type": "integer"
                            },
                            "failed": {
                              "type": "integer"
                            }
                          }
                        },
                        "errors": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "uuid": {
                                "type": "string"
                              },
                              "error": {
                                "type": "string"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request body or parameters"
          }
        }
      }
    },
    "/api/images/presignUrls": {
      "post": {
        "summary": "Generate presigned URLs for direct client-side image uploads",
        "tags": [
          "Images"
        ],
        "responses": {
          "200": {
            "description": "Successfully generated presigned URLs."
          },
          "400": {
            "description": "Invalid request body or parameters."
          }
        }
      }
    },
    "/api/sync/current": {
      "get": {
        "summary": "Get current sync sequence",
        "tags": [
          "Sync"
        ],
        "responses": {
          "200": {
            "description": "Current sync sequence"
          }
        }
      }
    },
    "/api/sync/operations": {
      "get": {
        "summary": "Get operations since a specific sequence",
        "tags": [
          "Sync"
        ],
        "parameters": [
          {
            "in": "query",
            "name": "since",
            "schema": {
              "type": "integer"
            },
            "description": "Sequence number to get operations after"
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer",
              "default": 100,
              "maximum": 1000
            },
            "description": "Maximum number of operations to return"
          }
        ],
        "responses": {
          "200": {
            "description": "List of operations"
          }
        }
      }
    },
    "/api/sync/my-operations": {
      "get": {
        "summary": "Get operations for current client",
        "tags": [
          "Sync"
        ],
        "parameters": [
          {
            "in": "header",
            "name": "X-Client-ID",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "Client identifier"
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer",
              "default": 100,
              "maximum": 1000
            },
            "description": "Maximum number of operations to return"
          }
        ],
        "responses": {
          "200": {
            "description": "List of client operations"
          }
        }
      }
    },
    "/api/sync/status": {
      "get": {
        "summary": "Get sync status",
        "tags": [
          "Sync"
        ],
        "parameters": [
          {
            "in": "header",
            "name": "X-Client-ID",
            "schema": {
              "type": "string"
            },
            "description": "Client identifier"
          },
          {
            "in": "header",
            "name": "X-Last-Sync-Sequence",
            "schema": {
              "type": "integer"
            },
            "description": "Client's last known sync sequence"
          }
        ],
        "responses": {
          "200": {
            "description": "Sync status information"
          }
        }
      }
    },
    "/webhook/minio": {
      "post": {
        "summary": "Handle MinIO webhook events",
        "tags": [
          "Webhook"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "description": "MinIO event notification payload"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Webhook event processed successfully"
          },
          "500": {
            "description": "Internal server error, MinIO should retry"
          }
        }
      }
    }
  }
}